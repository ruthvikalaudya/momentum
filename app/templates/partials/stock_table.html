<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full text-sm">
            <thead class="bg-slate-50 border-b border-slate-200">
                <tr>
                    <th class="px-4 py-3 text-left font-semibold text-slate-600 cursor-pointer hover:bg-slate-100"
                        hx-get="/stocks" hx-target="#stock-table-container" hx-include="#filters-form"
                        hx-vals='{"sort_by": "rank", "sort_dir": "{{ 'desc' if sort_by == 'rank' and sort_dir == 'asc' else 'asc' }}"}'
                        onclick="document.getElementById('sort_by').value='rank'; document.getElementById('sort_dir').value='{{ 'desc' if sort_by == 'rank' and sort_dir == 'asc' else 'asc' }}'">
                        Rank {% if sort_by == 'rank' %}{{ '↑' if sort_dir == 'asc' else '↓' }}{% endif %}
                    </th>
                    <th class="px-4 py-3 text-left font-semibold text-slate-600 cursor-pointer hover:bg-slate-100"
                        hx-get="/stocks" hx-target="#stock-table-container" hx-include="#filters-form"
                        hx-vals='{"sort_by": "symbol", "sort_dir": "{{ 'desc' if sort_by == 'symbol' and sort_dir == 'asc' else 'asc' }}"}'
                        onclick="document.getElementById('sort_by').value='symbol'; document.getElementById('sort_dir').value='{{ 'desc' if sort_by == 'symbol' and sort_dir == 'asc' else 'asc' }}'">
                        Symbol {% if sort_by == 'symbol' %}{{ '↑' if sort_dir == 'asc' else '↓' }}{% endif %}
                    </th>
                    <th class="px-4 py-3 text-left font-semibold text-slate-600 hidden md:table-cell cursor-pointer hover:bg-slate-100"
                        hx-get="/stocks" hx-target="#stock-table-container" hx-include="#filters-form"
                        hx-vals='{"sort_by": "industry", "sort_dir": "{{ 'desc' if sort_by == 'industry' and sort_dir == 'asc' else 'asc' }}"}'
                        onclick="document.getElementById('sort_by').value='industry'; document.getElementById('sort_dir').value='{{ 'desc' if sort_by == 'industry' and sort_dir == 'asc' else 'asc' }}'">
                        Industry {% if sort_by == 'industry' %}{{ '↑' if sort_dir == 'asc' else '↓' }}{% endif %}
                    </th>
                    <th class="px-4 py-3 text-right font-semibold text-slate-600 cursor-pointer hover:bg-slate-100"
                        hx-get="/stocks" hx-target="#stock-table-container" hx-include="#filters-form"
                        hx-vals='{"sort_by": "price", "sort_dir": "{{ 'asc' if sort_by == 'price' and sort_dir == 'desc' else 'desc' }}"}'
                        onclick="document.getElementById('sort_by').value='price'; document.getElementById('sort_dir').value='{{ 'asc' if sort_by == 'price' and sort_dir == 'desc' else 'desc' }}'">
                        Price {% if sort_by == 'price' %}{{ '↓' if sort_dir == 'desc' else '↑' }}{% endif %}
                    </th>
                    <th class="px-4 py-3 text-center font-semibold text-slate-600 hidden sm:table-cell cursor-pointer hover:bg-slate-100"
                        hx-get="/stocks" hx-target="#stock-table-container" hx-include="#filters-form"
                        hx-vals='{"sort_by": "market_cap", "sort_dir": "{{ 'asc' if sort_by == 'market_cap' and sort_dir == 'desc' else 'desc' }}"}'
                        onclick="document.getElementById('sort_by').value='market_cap'; document.getElementById('sort_dir').value='{{ 'asc' if sort_by == 'market_cap' and sort_dir == 'desc' else 'desc' }}'">
                        Market Cap {% if sort_by == 'market_cap' %}{{ '↓' if sort_dir == 'desc' else '↑' }}{% endif %}
                    </th>
                    <th class="px-4 py-3 text-right font-semibold text-slate-600 cursor-pointer hover:bg-slate-100"
                        hx-get="/stocks" hx-target="#stock-table-container" hx-include="#filters-form"
                        hx-vals='{"sort_by": "score", "sort_dir": "{{ 'asc' if sort_by == 'score' and sort_dir == 'desc' else 'desc' }}"}'
                        onclick="document.getElementById('sort_by').value='score'; document.getElementById('sort_dir').value='{{ 'asc' if sort_by == 'score' and sort_dir == 'desc' else 'desc' }}'">
                        Total Score {% if sort_by == 'score' %}{{ '↓' if sort_dir == 'desc' else '↑' }}{% endif %}
                    </th>
                    <th class="px-4 py-3 text-right font-semibold text-slate-600 cursor-pointer hover:bg-slate-100"
                        hx-get="/stocks" hx-target="#stock-table-container" hx-include="#filters-form"
                        hx-vals='{"sort_by": "confidence", "sort_dir": "{{ 'asc' if sort_by == 'confidence' and sort_dir == 'desc' else 'desc' }}"}'
                        onclick="document.getElementById('sort_by').value='confidence'; document.getElementById('sort_dir').value='{{ 'asc' if sort_by == 'confidence' and sort_dir == 'desc' else 'desc' }}'">
                        Confidence {% if sort_by == 'confidence' %}{{ '↓' if sort_dir == 'desc' else '↑' }}{% endif %}
                    </th>
                    <th class="px-4 py-3 text-left font-semibold text-slate-600 hidden xl:table-cell">Indexes</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-100">
                {% for stock in stocks %}
                <tr class="hover:bg-slate-50 transition-colors {{ 'bg-amber-50/50' if stock.is_top else '' }}">
                    <!-- Rank -->
                    <td class="px-4 py-3">
                        {% if stock.rank <= 3 %}
                        <span class="inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold
                            {% if stock.rank == 1 %}bg-yellow-400 text-yellow-900
                            {% elif stock.rank == 2 %}bg-slate-300 text-slate-700
                            {% else %}bg-amber-600 text-white{% endif %}">
                            {{ stock.rank }}
                        </span>
                        {% else %}
                        <span class="text-slate-500">{{ stock.rank }}</span>
                        {% endif %}
                    </td>
                    
                    <!-- Symbol & Name -->
                    <td class="px-4 py-3">
                        <div class="flex flex-col">
                            <a href="https://www.tradingview.com/chart/?symbol={{ stock.data.symbol }}" target="_blank" rel="noopener noreferrer"
                               class="font-semibold {{ 'text-amber-700 hover:text-amber-800' if stock.is_top else 'text-blue-600 hover:text-blue-800' }} hover:underline">
                                {{ stock.data.symbol }}
                                <svg class="inline w-3 h-3 ml-0.5 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                </svg>
                            </a>
                            <span class="text-xs text-slate-500 truncate max-w-[150px]">{{ stock.data.description }}</span>
                        </div>
                        {% if not stock.earnings_safe %}
                        <span class="inline-block mt-1 px-1.5 py-0.5 text-[10px] font-medium bg-red-100 text-red-700 rounded">Earnings Soon</span>
                        {% endif %}
                    </td>
                    
                    <!-- Industry (Sector) -->
                    <td class="px-4 py-3 hidden md:table-cell">
                        <div class="flex flex-col">
                            <span class="text-slate-700 text-xs font-medium">{{ stock.data.industry }}</span>
                            <span class="text-slate-400 text-[10px]">({{ stock.data.sector }})</span>
                        </div>
                    </td>
                    
                    <!-- Price (actual stock price) -->
                    <td class="px-4 py-3 text-right">
                        <span class="text-slate-900 font-medium">${{ "%.2f"|format(stock.data.price) }}</span>
                    </td>
                    
                    <!-- Market Cap with Tag -->
                    <td class="px-4 py-3 text-center hidden sm:table-cell">
                        {% set cap = stock.data.market_cap %}
                        {% set cap_b = cap / 1000000000 %}
                        <div class="flex flex-col items-center">
                            <span class="text-slate-800 font-semibold text-sm">${{ "%.1f"|format(cap_b) }}B</span>
                            {% if cap >= 200000000000 %}
                            <span class="px-2 py-0.5 text-[10px] font-bold bg-purple-100 text-purple-800 rounded mt-1">Mega</span>
                            {% elif cap >= 10000000000 %}
                            <span class="px-2 py-0.5 text-[10px] font-bold bg-blue-100 text-blue-800 rounded mt-1">Large</span>
                            {% elif cap >= 2000000000 %}
                            <span class="px-2 py-0.5 text-[10px] font-bold bg-green-100 text-green-800 rounded mt-1">Mid</span>
                            {% elif cap >= 300000000 %}
                            <span class="px-2 py-0.5 text-[10px] font-bold bg-yellow-100 text-yellow-800 rounded mt-1">Small</span>
                            {% else %}
                            <span class="px-2 py-0.5 text-[10px] font-bold bg-slate-100 text-slate-600 rounded mt-1">Micro</span>
                            {% endif %}
                        </div>
                    </td>
                    
                    <!-- Total Score -->
                    <td class="px-4 py-3 text-right">
                        <span class="font-bold {{ 'text-amber-700' if stock.is_top else 'text-slate-900' }}">{{ "%.1f"|format(stock.total_score) }}</span>
                    </td>
                    
                    <!-- Confidence Score -->
                    <td class="px-4 py-3 text-right">
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                            {% if stock.confidence >= 80 %}bg-green-100 text-green-800
                            {% elif stock.confidence >= 50 %}bg-yellow-100 text-yellow-800
                            {% else %}bg-red-100 text-red-800{% endif %}">
                            {{ "%.0f"|format(stock.confidence) }}%
                        </span>
                    </td>
                    
                    <!-- Indexes -->
                    <td class="px-4 py-3 hidden xl:table-cell">
                        <div class="flex flex-wrap gap-1 max-w-[200px]">
                            {% for idx in stock.data.indexes.split(', ')[:3] %}
                            {% if idx and 'S&P 500' in idx or 'Russell' in idx or 'NASDAQ 100' in idx %}
                            <span class="px-1.5 py-0.5 text-[10px] font-medium bg-blue-100 text-blue-700 rounded">{{ idx.split(' ')[0] }}{{ idx.split(' ')[1] if idx.split(' ')|length > 1 else '' }}</span>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="px-4 py-3 bg-slate-50 border-t border-slate-200 text-sm text-slate-500">
        Showing {{ stocks|length }} stocks
    </div>
</div>